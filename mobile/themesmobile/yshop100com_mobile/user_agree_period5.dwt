
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1, user-scalable=no">
</head>
<link href="themesmobile/yshop100com_mobile/css/passwordkeyboard.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="themesmobile/yshop100com_mobile/js/jquery.min.js"></script>
<script type="text/javascript" src="themesmobile/yshop100com_mobile/js/fastclick.js"></script>
<script type="text/javascript" src="themesmobile/yshop100com_mobile/js/jquery.md5.js"></script>
<script src="themesmobile/yshop100com_mobile/js/rollups/aes.js"></script>
<script src="themesmobile/yshop100com_mobile/js/rollups/md5.js"></script>
<script src="themesmobile/yshop100com_mobile/js/components/pad-zeropadding.js"></script>
<script>
    function init(){
        var width=$(window).width();
        var height=$(window).height();
        $("body").css("height",height);
        $("body").css("width",width);
    }
    window.addEventListener('load', function() {
    	  FastClick.attach(document.body);
    	}, false);
</script>
<body onload="init()">
<div>
<div style="text-align: center;padding-top: 10px;p"><span id="set_text" style="font-size: large;"></span></div>
<div style="padding-top: 20px;text-align: center;">
<form id="password">
<input readonly class="pass" type="password" maxlength="1" value=""><input readonly class="pass" type="password" maxlength="1" value=""><input readonly class="pass" type="password" maxlength="1" value=""><input readonly class="pass" type="password" maxlength="1" value=""><input readonly class="pass" type="password" maxlength="1" value=""><input readonly class="pass pass_right" type="password" maxlength="1" value="">
</form>
</div>
</div>
<div id="keyboardDIV"></div>
</body>
<form id="formIdentity" action="user_agree_period.php" method="post" style="display:none"   enctype="multipart/form-data">
<input type="hidden"   name="pwd" id="pwd" />
<input type="hidden"   name="k1" id="k1" />
<input type="hidden"  name="card" value="{$card}"/> 
<input type="hidden"  name="ispwd" id="ispwd" value="1"/>
		<input name="act" type="hidden" value="act_identity" />
		<input name="submit1" type="submit" value="确认" style="display:none" />
</form>
<script type="text/javascript" >
function encrypt(data) {
    var key = CryptoJS.enc.Latin1.parse('7830405678906543');      
            var iv =    CryptoJS.enc.Latin1.parse('6007890983456673');      
            return CryptoJS.AES.encrypt(data, key, { iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.ZeroPadding });
}
var check_pass_word='';
var passwords=$('#password').get(0);
$(function(){
	var div='\
	<div id="key" style="position:absolute;background-color:#A8A8A8;width:99.5%;bottom:0px;">\
		<ul id="keyboard" style="font-size:20px;margin:2px -2px 1px 2px">\
			<li class="symbol"><span class="off">1</span></li>\
			<li class="symbol"><span class="off">2</span></li>\
			<li class="symbol btn_number_"><span class="off">3</span></li>\
			<li class="tab"><span class="off">4</span></li>\
			<li class="symbol"><span class="off">5</span></li>\
			<li class="symbol btn_number_"><span class="off">6</span></li>\
			<li class="tab"><span class="off">7</span></li>\
			<li class="symbol"><span class="off">8</span></li>\
			<li class="symbol btn_number_"><span class="off">9</span></li>\
			<li class="delete lastitem">删除</li>\
			<li class="symbol"><span class="off">0</span></li>\
			<li class="cancle btn_number_">取消</li>\
		</ul>\
	</div>\
	';
	var character,index=0;
	$("input.pass").attr("disabled",true);
	$("#password").attr("disabled",true);
	$("#keyboardDIV").html(div);
	$('#keyboard li').click(function(){
		if($(this).hasClass('delete')){$(passwords.elements[--index%6]).val('');
			if($(passwords.elements[0]).val()==''){index=0;}
			return false;
		}
		if($(this).hasClass('cancle')){parentDialog.close();return false;}
		if($(this).hasClass('symbol')||$(this).hasClass('tab')){
		character=$(this).text();
		$(passwords.elements[index++%6]).val(character);
		if($(passwords.elements[5]).val()!=''){index=0;}
		if($(passwords.elements[5]).val()!=''){
			var temp_rePass_word='';
			for(var i=0;i<passwords.elements.length;i++){
			temp_rePass_word+=$(passwords.elements[i]).val();
			}
			check_pass_word=temp_rePass_word; 
			if($("#k1").val()==""){
				$("#k1").val(check_pass_word);
				for(var i=0;i<passwords.elements.length;i++){
				$(passwords.elements[i]).val("");
				}
				var set_text='\
					<span>请重新输入支付密码</span>\
					';
					$("#set_text").html(set_text);
			}
			else{
				if($("#k1").val()!=check_pass_word){
				for(var i=0;i<passwords.elements.length;i++){
				$(passwords.elements[i]).val("");
				}
				$("#k1").val("");
					var set_text='\
						<span>两次密码不一致，请重新设置支付密码</span>\
						';
						$("#set_text").html(set_text);
				}
				else{
					$("#key").hide();
					$("#pwd").val($.md5($.md5(check_pass_word))); 
					 document.getElementById("formIdentity").submit();
				}
			} 
		}}
		return false;
	});
	function change(){document.location="/mobile/flow.php";}
});
(function(){
	function tabForward(e){
		e=e||window.event;var target=e.target||e.srcElement;
		if(target.value.length===target.maxLength){
			var form=target.form;
			for(var i=0,len=form.elements.length-1;i<len;i++){
				if(form.elements[i]===target){
					if(form.elements[i++]){
						form.elements[i++].focus();
					}
					break;
				}
			}
		}
	}
	var form=document.getElementById("password");
	form.addEventListener("keyup",tabForward,false);
	var set_text='\
	<span>请输入6位密码，设置支付密码</span>\
	';
	$("#set_text").html(set_text);
})();
</script>
</html>